# Vulnerability checking policy

**Summary:** Vulnerability checking (govulncheck and the `security` tool) is **not** run on every commit or push. It runs **before release** only, via `make pre-release`.

---

## When checks run

| When | What runs | Vulnerability check? |
|------|-----------|------------------------|
| **Pre-commit** | Build + health docs | No |
| **Pre-push** | `analyze_alignment todo2` | No |
| **Before release** | `make pre-release` | Yes (build + govulncheck + security scan) |

---

## Before release

Run this before tagging or publishing a release:

```bash
make pre-release
```

This runs, in order:

1. **Build** – `make build` (must succeed)
2. **govulncheck** – `govulncheck ./...` (Go vulnerability DB)
3. **Security scan** – `exarp-go -tool security -args '{"action":"scan"}'`

If any step fails, fix the issues before releasing.

---

## Why not on every commit/push?

- **Speed** – govulncheck and the security scan add noticeable time to each commit/push.
- **Focus** – Day-to-day workflow stays fast; release gates catch vulnerabilities.
- **CI** – The Go CI workflow (`.github/workflows/go.yml`) still runs a dedicated `security` job with govulncheck on push/PR, so main/develop are covered.

---

## Related

- **Git hooks:** Installed via `exarp-go -tool setup_hooks -args '{"action":"git"}'`. Hook content is in `internal/tools/hooks_setup.go`.
- **Automation table:** [TASKS_AS_CI_AND_AUTOMATION.md](TASKS_AS_CI_AND_AUTOMATION.md) – Pre-commit, pre-push, and “Before release” row.
- **CLAUDE.md** – Pre-commit hook description and `make pre-release` note.
