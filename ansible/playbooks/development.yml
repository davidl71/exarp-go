---
# Development environment setup playbook
# Installs all dependencies including optional linters and dev tools

- name: Setup Development Environment
  hosts: development
  become: true
  gather_facts: true

  roles:
    - role: common
      tags:
        - common
        - always

    - role: golang
      tags:
        - golang
        - always

    - role: python
      tags:
        - python
        - always

    - role: linters
      when: install_linters | default(false)
      tags:
        - linters
        - optional

  tasks:
    - name: Create project directory
      ansible.builtin.file:
        path: "{{ project_path }}"
        state: directory
        owner: "{{ project_user }}"
        mode: '0755'
      tags:
        - common

    - name: Install development file watchers
      when: install_file_watchers | default(false)
      tags:
        - dev_tools
        - optional
      block:
        - name: Install fswatch (macOS)
          community.general.homebrew:
            name: fswatch
            state: present
          when: ansible_system == "Darwin"
          tags:
            - dev_tools
            - optional

        - name: Install inotify-tools (Linux)
          ansible.builtin.package:
            name: inotify-tools
            state: present
          when: ansible_system == "Linux"
          tags:
            - dev_tools
            - optional

    - name: Display development environment summary
      ansible.builtin.debug:
        msg:
          - "âœ… Development environment setup complete"
          - "Go version: {{ go_version }}"
          - "Python version: {{ python_version }}"
          - "Project path: {{ project_path }}"
          - "Linters installed: {{ install_linters | default(false) }}"
          - "Dev tools installed: {{ install_dev_tools | default(false) }}"
          - "GitHub CLI (gh) installed: {{ install_gh | default(false) }}"
      tags:
        - always
